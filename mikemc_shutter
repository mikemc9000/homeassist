blueprint:
  name: Rollo Steuerung mit Hue Dimmer Switch
  description: Steuere ein Rollo mit einem Hue Dimmer Switch (hoch und runter), das bei erneutem Drücken anhält.
  domain: automation
  input:
    rollo:
      name: Rollo
      description: Die zu steuernde Rollo
      selector:
        entity:
          domain: cover
    button_up:
      name: Taste Hoch
      description: Wähle die Taste, die das Rollo hochfährt
      selector:
        select:
          options:
            - on-press
            - on-hold
            - on-release
            - up-press
            - up-hold
            - up-release
    button_down:
      name: Taste Runter
      description: Wähle die Taste, die das Rollo runterfährt
      selector:
        select:
          options:
            - down-press
            - down-hold
            - down-release
            - off-press
            - off-hold
            - off-release
    hue_dimmer:
      name: Hue Dimmer Switch
      description: Der Hue Dimmer Switch, der die Aktionsevents sendet
      selector:
        entity:
          domain: sensor

variables:
  rollo: !input rollo
  hue_dimmer: !input hue_dimmer
  button_up: !input button_up
  button_down: !input button_down

trigger:
  - platform: state
    entity_id: !input hue_dimmer
    to: !input button_up
    id: 'button_up'
  - platform: state
    entity_id: !input hue_dimmer
    to: !input button_down
    id: 'button_down'

condition: []

action:
  - choose:
      - conditions:
          - condition: trigger
            id: 'button_up'
        sequence:
          - choose:
              - conditions:
                  - condition: state
                    entity_id: !input rollo
                    state: 'opening'
                sequence:
                  - service: cover.stop_cover
                    target:
                      entity_id: !input rollo
              - conditions:
                  - condition: state
                    entity_id: !input rollo
                    state: 'closed'
                sequence:
                  - service: cover.open_cover
                    target:
                      entity_id: !input rollo
              - conditions:
                  - condition: state
                    entity_id: !input rollo
                    state: 'open'
                sequence:
                  - service: cover.stop_cover
                    target:
                      entity_id: !input rollo
              - conditions:
                  - condition: state
                    entity_id: !input rollo
                    state: 'stopped'
                sequence:
                  - service: cover.open_cover
                    target:
                      entity_id: !input rollo
      - conditions:
          - condition: trigger
            id: 'button_down'
        sequence:
          - choose:
              - conditions:
                  - condition: state
                    entity_id: !input rollo
                    state: 'closing'
                sequence:
                  - service: cover.stop_cover
                    target:
                      entity_id: !input rollo
              - conditions:
                  - condition: state
                    entity_id: !input rollo
                    state: 'open'
                sequence:
                  - service: cover.close_cover
                    target:
                      entity_id: !input rollo
              - conditions:
                  - condition: state
                    entity_id: !input rollo
                    state: 'closed'
                sequence:
                  - service: cover.stop_cover
                    target:
                      entity_id: !input rollo
              - conditions:
                  - condition: state
                    entity_id: !input rollo
                    state: 'stopped'
                sequence:
                  - service: cover.close_cover
                    target:
                      entity_id: !input rollo
